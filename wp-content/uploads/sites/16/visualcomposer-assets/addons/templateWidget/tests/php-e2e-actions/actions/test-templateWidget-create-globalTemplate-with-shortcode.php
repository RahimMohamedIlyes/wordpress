<?php

if (!defined('VCV_E2E')) {
    header('Status: 403 Forbidden');
    header('HTTP/1.1 403 Forbidden');
    exit;
}

if (isset($_GET['php-e2e-action'])
    && $_GET['php-e2e-action'] === 'test-templateWidget-create-globalTemplate-with-shortcode') {
    // We are on PRE wordpress init stage.
    define('WP_USE_THEMES', true);
    add_action('init', [TestTemplateWidgetCreateGlobalTemplateWithShortcode::class, 'createInstance']);

    class TestTemplateWidgetCreateGlobalTemplateWithShortcode
    {
        /**
         * @var int|\WP_Error
         */
        protected $postId;

        /**
         * @var int|\WP_Error
         */
        protected $templateId;

        public function __construct()
        {
            $this->createTemplate();
            $this->createPost();

            add_action('wp_loaded', [$this, 'setupPage']);
        }

        public static function createInstance()
        {
            return new self();
        }

        public function createTemplate()
        {
            // Set up the WordPress query.
            $this->templateId = e2e_create_post(
                [
                    'post_title' => 'test-templateWidget-create-globalTemplate-with-shortcode',
                    'post_content' => '<!--vcv no format--><div class="vce-row-container"><div class="vce-row vce-row--col-gap-30 vce-row-columns--top vce-row-content--top" id="el-1e35ec3b" data-vce-do-apply="all el-1e35ec3b"><div class="vce-row-content" data-vce-element-content="true"><div class="vce-col vce-col--md-auto vce-col--xs-1 vce-col--xs-last vce-col--xs-first vce-col--sm-last vce-col--sm-first vce-col--md-last vce-col--lg-last vce-col--xl-last vce-col--md-first vce-col--lg-first vce-col--xl-first" id="el-5780fb30"><div class="vce-col-inner" data-vce-do-apply="border margin background  el-5780fb30"><div class="vce-col-content" data-vce-element-content="true" data-vce-do-apply="padding el-5780fb30"><div class="vce-text-block"><div class="vce-text-block-wrapper vce" id="el-7d5c92f4" data-vce-do-apply="all el-7d5c92f4">Global Template<div class="global-template-title">[e2e_get_the_title]</div></div></div></div></div></div></div></div></div><!--vcv no format-->',
                    'post_status' => 'publish',
                    'post_type' => 'vcv_templates',
                    'meta_input' => [
                        'vcv-pageContent' => '%7B%22elements%22%3A%7B%227d5c92f4%22%3A%7B%22darkTextSkin%22%3Afalse%2C%22designOptions%22%3A%7B%7D%2C%22output%22%3A%22Global%20Template%5Cn%3Cdiv%20class%3D%5C%22global-template-title%5C%22%3E%5Cn%5Be2e_get_the_title%5D%5Cn%3C%2Fdiv%3E%22%2C%22customClass%22%3A%22%22%2C%22parent%22%3A%225780fb30%22%2C%22hidden%22%3Afalse%2C%22metaAssetsPath%22%3A%22http%3A%2F%2Fvclocal.cagdas%2Fwp-content%2Fplugins%2Fbuilder%2Felements%2FtextBlock%2FtextBlock%2Fpublic%2F%22%2C%22order%22%3A0%2C%22metaCustomId%22%3A%22%22%2C%22metaIsElementLocked%22%3Afalse%2C%22assetsLibrary%22%3A%5B%22animate%22%5D%2C%22metaElementAssets%22%3A%7B%22googleFonts%22%3A%7B%22output%22%3A%7B%7D%7D%7D%2C%22customHeaderTitle%22%3A%22%22%2C%22tag%22%3A%22textBlock%22%2C%22id%22%3A%227d5c92f4%22%7D%2C%225780fb30%22%3A%7B%22size%22%3A%7B%22all%22%3A%22auto%22%2C%22defaultSize%22%3A%22auto%22%7D%2C%22designOptionsAdvanced%22%3A%7B%7D%2C%22firstInRow%22%3A%7B%22all%22%3Atrue%7D%2C%22customClass%22%3A%22%22%2C%22sticky%22%3A%7B%7D%2C%22parent%22%3A%221e35ec3b%22%2C%22hidden%22%3Afalse%2C%22boxShadow%22%3A%7B%7D%2C%22metaAssetsPath%22%3A%22http%3A%2F%2Fvclocal.cagdas%2Fwp-content%2Fplugins%2Fbuilder%2Felements%2Fcolumn%2Fcolumn%2Fpublic%2F%22%2C%22order%22%3A0%2C%22metaCustomId%22%3A%22%22%2C%22parallax%22%3A%7B%7D%2C%22metaIsElementLocked%22%3Afalse%2C%22dividers%22%3A%7B%7D%2C%22metaElementAssets%22%3A%7B%7D%2C%22customHeaderTitle%22%3A%22%22%2C%22tag%22%3A%22column%22%2C%22id%22%3A%225780fb30%22%2C%22lastInRow%22%3A%7B%22all%22%3Atrue%7D%7D%2C%221e35ec3b%22%3A%7B%22columnGap%22%3A%2230%22%2C%22size%22%3A%22auto%22%2C%22contentPosition%22%3A%22top%22%2C%22designOptionsAdvanced%22%3A%7B%7D%2C%22columnBackground%22%3A%22%22%2C%22customClass%22%3A%22%22%2C%22sticky%22%3A%7B%7D%2C%22parent%22%3Afalse%2C%22hidden%22%3Afalse%2C%22layout%22%3A%7B%7D%2C%22boxShadow%22%3A%7B%7D%2C%22rowWidth%22%3A%22boxed%22%2C%22metaAssetsPath%22%3A%22http%3A%2F%2Fvclocal.cagdas%2Fwp-content%2Fplugins%2Fbuilder%2Felements%2Frow%2Frow%2Fpublic%2F%22%2C%22order%22%3A1%2C%22metaCustomId%22%3A%22%22%2C%22removeSpaces%22%3Afalse%2C%22fullHeight%22%3Afalse%2C%22parallax%22%3A%7B%7D%2C%22metaIsElementLocked%22%3Afalse%2C%22dividers%22%3A%7B%7D%2C%22metaElementAssets%22%3A%7B%7D%2C%22customHeaderTitle%22%3A%22%22%2C%22tag%22%3A%22row%22%2C%22id%22%3A%221e35ec3b%22%2C%22equalHeight%22%3Afalse%2C%22columnPosition%22%3A%22top%22%7D%7D%7D',
                        '_vcv-type' => 'custom',
                        'vcvSourceAssetsFiles' => 'a:2:{s:9:"jsBundles";a:0:{}s:10:"cssBundles";a:1:{i:0;s:59:"assetsLibrary/imageFilter/dist/imageFilter.bundle.css?v=dev";}}',
                        'vcv-globalElementsCssData' => unserialize(
                            'a:3:{s:8:"7d5c92f4";a:4:{s:3:"tag";s:9:"textBlock";s:7:"baseCss";s:0:"";s:13:"attributesCss";s:0:"";s:9:"mixinsCss";s:0:"";}s:8:"5780fb30";a:4:{s:3:"tag";s:6:"column";s:13:"attributesCss";s:0:"";s:9:"mixinsCss";s:0:"";s:7:"baseCss";s:3039:".vce-col{-ms-flex:0 0 100%;-webkit-flex:0 0 100%;flex:0 0 100%;max-width:100%;box-sizing:border-box;display:-ms-flexbox;display:-webkit-flex;display:flex;min-width:1em;position:relative}.vce-col--auto{-ms-flex:1;-webkit-flex:1;flex:1;-ms-flex-preferred-size:auto;-webkit-flex-basis:auto;flex-basis:auto}.vce-col-content,.vce-col-inner{position:relative;overflow-wrap:break-word;transition:box-shadow .2s}.vce-col-inner{width:100%}.vce-col-direction--rtl{direction:rtl}.vce-element--has-background>.vce-col-inner>.vce-col-content{padding-top:30px;padding-left:30px;padding-right:30px}.vce-col.vce-col--all-hide{display:none}@media (min-width:0){.vce-col--xs-auto{-ms-flex:1 1 0;-webkit-flex:1 1 0;flex:1 1 0;width:auto}.vce-col--xs-1{-ms-flex:0 0 100%;-webkit-flex:0 0 100%;flex:0 0 100%;max-width:100%}.vce-col.vce-col--xs-visible{display:-ms-flexbox;display:-webkit-flex;display:flex}.vce-col.vce-col--xs-hide{display:none}}.vce-row-container>.vce-row>.vce-row-content>.vce-col>.vce-col-inner{padding:0}@media (min-width:544px){.vce-col--sm-auto{-ms-flex:1 1 0;-webkit-flex:1 1 0;flex:1 1 0;width:auto}.vce-col--sm-1{-ms-flex:0 0 100%;-webkit-flex:0 0 100%;flex:0 0 100%;max-width:100%}.vce-col.vce-col--sm-visible{display:-ms-flexbox;display:-webkit-flex;display:flex}.vce-col.vce-col--sm-hide{display:none}}@media (min-width:768px){.vce-col--md-auto{-ms-flex:1 1 0;-webkit-flex:1 1 0;flex:1 1 0;width:auto}.vce-col--md-1{-ms-flex:0 0 100%;-webkit-flex:0 0 100%;flex:0 0 100%;max-width:100%}.vce-col.vce-col--md-visible{display:-ms-flexbox;display:-webkit-flex;display:flex}.vce-col.vce-col--md-hide{display:none}}@media (min-width:992px){.vce-col--lg-auto{-ms-flex:1 1 0;-webkit-flex:1 1 0;flex:1 1 0;width:1px}.vce-col--lg-1{-ms-flex:0 0 100%;-webkit-flex:0 0 100%;flex:0 0 100%;max-width:100%}.vce-col.vce-col--lg-visible{display:-ms-flexbox;display:-webkit-flex;display:flex}.vce-col.vce-col--lg-hide{display:none}}@media (min-width:1200px){.vce-col--xl-auto{-ms-flex:1 1 0;-webkit-flex:1 1 0;flex:1 1 0;width:auto}.vce-col--xl-1{-ms-flex:0 0 100%;-webkit-flex:0 0 100%;flex:0 0 100%;max-width:100%}.vce-col.vce-col--xl-visible{display:-ms-flexbox;display:-webkit-flex;display:flex}.vce-col.vce-col--xl-hide{display:none}}@media (min-width:0) and (max-width:543px){.vce-element--xs--has-background>.vce-col-inner>.vce-col-content{padding-top:30px;padding-left:30px;padding-right:30px}}@media (min-width:544px) and (max-width:767px){.vce-element--sm--has-background>.vce-col-inner>.vce-col-content{padding-top:30px;padding-left:30px;padding-right:30px}}@media (min-width:768px) and (max-width:991px){.vce-element--md--has-background>.vce-col-inner>.vce-col-content{padding-top:30px;padding-left:30px;padding-right:30px}}@media (min-width:992px) and (max-width:1199px){.vce-element--lg--has-background>.vce-col-inner>.vce-col-content{padding-top:30px;padding-left:30px;padding-right:30px}}@media (min-width:1200px){.vce-element--xl--has-background>.vce-col-inner>.vce-col-content{padding-top:30px;padding-left:30px;padding-right:30px}}";}s:8:"1e35ec3b";a:4:{s:3:"tag";s:3:"row";s:7:"baseCss";s:7301:".vce{margin-bottom:30px}.vce-row-container{width:100%}.vce-row{position:relative;display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column;margin-left:0;margin-right:0;transition:box-shadow .2s}.vce-row-content>.vce-col:last-child{margin-right:0}.vce-row-full-height{min-height:100vh}.vce-row-content{-ms-flex:1 1 auto;-webkit-flex:1 1 auto;flex:1 1 auto;display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;-webkit-flex-wrap:wrap;flex-wrap:wrap;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-ms-flex-line-pack:start;-webkit-align-content:flex-start;align-content:flex-start;-ms-flex-align:start;-webkit-align-items:flex-start;align-items:flex-start;min-height:1em;position:relative}.vce-row-wrap--reverse>.vce-row-content{-ms-flex-wrap:wrap-reverse;-webkit-flex-wrap:wrap-reverse;flex-wrap:wrap-reverse;-ms-flex-line-pack:end;-webkit-align-content:flex-end;align-content:flex-end;-ms-flex-align:end;-webkit-align-items:flex-end;align-items:flex-end}.vce-row-columns--top>.vce-row-content{-ms-flex-line-pack:start;-webkit-align-content:flex-start;align-content:flex-start}.vce-row-columns--top.vce-row-wrap--reverse>.vce-row-content{-ms-flex-line-pack:end;-webkit-align-content:flex-end;align-content:flex-end}.vce-row-columns--middle>.vce-row-content{-ms-flex-line-pack:center;-webkit-align-content:center;align-content:center}.vce-row-columns--bottom>.vce-row-content{-ms-flex-line-pack:end;-webkit-align-content:flex-end;align-content:flex-end}.vce-row-columns--bottom.vce-row-wrap--reverse>.vce-row-content{-ms-flex-line-pack:start;-webkit-align-content:flex-start;align-content:flex-start}.vce-row-columns--bottom>.vce-row-content:after,.vce-row-columns--middle>.vce-row-content:after,.vce-row-columns--top>.vce-row-content:after{content:"";width:100%;height:0;overflow:hidden;visibility:hidden;display:block}.vce-row-content--middle>.vce-row-content>.vce-col>.vce-col-inner{display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column}.vce-row-content--bottom>.vce-row-content>.vce-col>.vce-col-inner{display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;-ms-flex-direction:column;-webkit-flex-direction:column;flex-direction:column}.vce-row-equal-height>.vce-row-content{-ms-flex-align:stretch;-webkit-align-items:stretch;align-items:stretch}.vce-row-columns--stretch>.vce-row-content{-ms-flex-line-pack:stretch;-webkit-align-content:stretch;align-content:stretch;-ms-flex-align:stretch;-webkit-align-items:stretch;align-items:stretch}.vce-row[data-vce-full-width=true]{position:relative;box-sizing:border-box}.vce-row[data-vce-stretch-content=true]{padding-left:30px;padding-right:30px}.vce-row[data-vce-stretch-content=true].vce-row-no-paddings{padding-left:0;padding-right:0}.vce-row.vce-element--has-background{padding-left:30px;padding-right:30px;padding-top:30px}.vce-row.vce-element--has-background[data-vce-full-width=true]:not([data-vce-stretch-content=true]){padding-left:0;padding-right:0}.vce-row.vce-element--has-background.vce-row--has-col-background{padding-bottom:30px}.vce-row>.vce-row-content>.vce-col.vce-col--all-last{margin-right:0}.rtl .vce-row>.vce-row-content>.vce-col.vce-col--all-last,.rtl.vce-row>.vce-row-content>.vce-col.vce-col--all-last{margin-left:0}@media (min-width:0) and (max-width:543px){.vce-row.vce-element--xs--has-background{padding-left:30px;padding-right:30px;padding-top:30px}.vce-row.vce-element--xs--has-background[data-vce-full-width=true]:not([data-vce-stretch-content=true]){padding-left:0;padding-right:0}.vce-row.vce-element--xs--has-background.vce-row--xs--has-col-background{padding-bottom:30px}.vce-row.vce-element--xs--has-background.vce-row--has-col-background{padding-bottom:30px}.vce-row.vce-element--has-background.vce-row--xs--has-col-background{padding-bottom:30px}.vce-row>.vce-row-content>.vce-col.vce-col--xs-last{margin-right:0}.rtl .vce-row>.vce-row-content>.vce-col.vce-col--xs-last,.rtl.vce-row>.vce-row-content>.vce-col.vce-col--xs-last{margin-left:0}}@media (min-width:544px) and (max-width:767px){.vce-row.vce-element--sm--has-background{padding-left:30px;padding-right:30px;padding-top:30px}.vce-row.vce-element--sm--has-background[data-vce-full-width=true]:not([data-vce-stretch-content=true]){padding-left:0;padding-right:0}.vce-row.vce-element--sm--has-background.vce-row--sm--has-col-background{padding-bottom:30px}.vce-row.vce-element--sm--has-background.vce-row--has-col-background{padding-bottom:30px}.vce-row.vce-element--has-background.vce-row--sm--has-col-background{padding-bottom:30px}.vce-row>.vce-row-content>.vce-col.vce-col--sm-last{margin-right:0}.rtl .vce-row>.vce-row-content>.vce-col.vce-col--sm-last,.rtl.vce-row>.vce-row-content>.vce-col.vce-col--sm-last{margin-left:0}}@media (min-width:768px) and (max-width:991px){.vce-row.vce-element--md--has-background{padding-left:30px;padding-right:30px;padding-top:30px}.vce-row.vce-element--md--has-background[data-vce-full-width=true]:not([data-vce-stretch-content=true]){padding-left:0;padding-right:0}.vce-row.vce-element--md--has-background.vce-row--md--has-col-background{padding-bottom:30px}.vce-row.vce-element--md--has-background.vce-row--has-col-background{padding-bottom:30px}.vce-row.vce-element--has-background.vce-row--md--has-col-background{padding-bottom:30px}.vce-row>.vce-row-content>.vce-col.vce-col--md-last{margin-right:0}.rtl .vce-row>.vce-row-content>.vce-col.vce-col--md-last,.rtl.vce-row>.vce-row-content>.vce-col.vce-col--md-last{margin-left:0}}@media (min-width:992px) and (max-width:1199px){.vce-row.vce-element--lg--has-background{padding-left:30px;padding-right:30px;padding-top:30px}.vce-row.vce-element--lg--has-background[data-vce-full-width=true]:not([data-vce-stretch-content=true]){padding-left:0;padding-right:0}.vce-row.vce-element--lg--has-background.vce-row--lg--has-col-background{padding-bottom:30px}.vce-row.vce-element--lg--has-background.vce-row--has-col-background{padding-bottom:30px}.vce-row.vce-element--has-background.vce-row--lg--has-col-background{padding-bottom:30px}.vce-row>.vce-row-content>.vce-col.vce-col--lg-last{margin-right:0}.rtl .vce-row>.vce-row-content>.vce-col.vce-col--lg-last,.rtl.vce-row>.vce-row-content>.vce-col.vce-col--lg-last{margin-left:0}}@media (min-width:1200px){.vce-row.vce-element--xl--has-background{padding-left:30px;padding-right:30px;padding-top:30px}.vce-row.vce-element--xl--has-background[data-vce-full-width=true]:not([data-vce-stretch-content=true]){padding-left:0;padding-right:0}.vce-row.vce-element--xl--has-background.vce-row--xl--has-col-background{padding-bottom:30px}.vce-row.vce-element--xl--has-background.vce-row--has-col-background{padding-bottom:30px}.vce-row.vce-element--has-background.vce-row--xl--has-col-background{padding-bottom:30px}.vce-row>.vce-row-content>.vce-col.vce-col--xl-last{margin-right:0}.rtl .vce-row>.vce-row-content>.vce-col.vce-col--xl-last,.rtl.vce-row>.vce-row-content>.vce-col.vce-col--xl-last{margin-left:0}}";s:13:"attributesCss";s:705:" @media all and (min-width:544px){.vce-row--col-gap-30#el-1e35ec3b>.vce-row-content>.vce-col--sm-auto{-webkit-flex:1 1 0;-ms-flex:1 1 0px;flex:1 1 0;width:auto;max-width:none}} @media all and (min-width:768px){.vce-row--col-gap-30#el-1e35ec3b>.vce-row-content>.vce-col--md-auto{-webkit-flex:1 1 0;-ms-flex:1 1 0px;flex:1 1 0;width:auto;max-width:none}} @media all and (min-width:992px){.vce-row--col-gap-30#el-1e35ec3b>.vce-row-content>.vce-col--lg-auto{-webkit-flex:1 1 0;-ms-flex:1 1 0px;flex:1 1 0;width:auto;max-width:none}} @media all and (min-width:1200px){.vce-row--col-gap-30#el-1e35ec3b>.vce-row-content>.vce-col--xl-auto{-webkit-flex:1 1 0;-ms-flex:1 1 0px;flex:1 1 0;width:auto;max-width:none}}";s:9:"mixinsCss";s:297:".vce-row--col-gap-30>.vce-row-content>.vce-col{margin-right:30px}.vce-row--col-gap-30>.vce-row-content>.vce-column-resizer .vce-column-resizer-handler{width:30px}.rtl .vce-row--col-gap-30>.vce-row-content>.vce-col,.rtl.vce-row--col-gap-30>.vce-row-content>.vce-col{margin-left:30px;margin-right:0}";}}'
                        ),
                    ],
                ]
            );
        }

        public function createPost()
        {
            $postContent = '<!--vcv no format--><div class="vce-row-container"><div class="vce-row vce-row--col-gap-30 vce-row-columns--top vce-row-content--top" id="el-90a5946f" data-vce-do-apply="all el-90a5946f"><div class="vce-row-content" data-vce-element-content="true"><div class="vce-col vce-col--md-auto vce-col--xs-1 vce-col--xs-last vce-col--xs-first vce-col--sm-last vce-col--sm-first vce-col--md-last vce-col--lg-last vce-col--xl-last vce-col--md-first vce-col--lg-first vce-col--xl-first" id="el-c3e370ff"><div class="vce-col-inner" data-vce-do-apply="border margin background  el-c3e370ff"><div class="vce-col-content" data-vce-element-content="true" data-vce-do-apply="padding el-c3e370ff"><div class="vce-widgets-container"><div class="vce vce-widgets-wrapper" id="el-346ced85" data-vce-do-apply="all el-346ced85">[vcv_widgets tag="wpWidgetsCustom" key="templateWidget%5CtemplateWidget%5CTemplateWidget" instance="%7B%22widget-form%22%3A%5Bnull%2C%7B%22template%22%3A%22||globalTemplateId||%22%7D%5D%7D" args="%7B%22before_title%22%3A%22%22%2C%22after_title%22%3A%22%22%2C%22before_widget%22%3A%22%22%2C%22after_widget%22%3A%22%22%7D"]</div></div></div></div></div></div></div></div><!--vcv no format-->';
            $postContent = str_replace('||globalTemplateId||', $this->templateId, $postContent);
            $this->postId = e2e_create_post(
                [
                    'post_title' => 'test-templateWidget-create-globalTemplate-with-shortcode-page-title',
                    'post_content' => $postContent,
                    'post_status' => 'publish',
                    'post_type' => 'page',
                ]
            );
        }

        public function setupPage()
        {
            // Create rewrite rules, to avoid 404 issues and extra redirects
            e2e_add_rewrite_rules();

            // Setup global query
            wp(['p' => $this->postId, 'post_type' => 'page']);

            // Load the theme template.
            require_once ABSPATH . WPINC . '/template-loader.php';
        }
    }
}
